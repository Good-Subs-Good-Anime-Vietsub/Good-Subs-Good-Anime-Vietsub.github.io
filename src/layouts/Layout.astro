---
import SocialIcon from '../components/SocialIcon.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import Popup from '../components/Popup.astro';

interface Props {
	title: string;
  description?: string;
  image?: string;
  schema?: string; // New prop for JSON-LD schema
}

const { 
  title, 
  description = 'GSGA Fansub - Anime hay, Phụ đề cũng phải tốt',
  image = new URL('/GSGA-logo.png', Astro.site).href,
  schema // Destructure new prop
} = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "GSGA Fansub - Good Subs Good Anime",
  "url": Astro.site,
  "description": "GSGA Fansub - Anime hay, Phụ đề cũng phải tốt. Nơi tổng hợp các bộ anime hay với phụ đề tiếng Việt chất lượng cao. Khám phá các dự án anime vietsub mới nhất, từ phim điện ảnh đến series, với trải nghiệm xem tốt nhất.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `${Astro.site}search?q={search_term_string}`
    },
    "query-input": "required name=search_term_string"
  }
};
---

<!doctype html>
<html lang="vi" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/png" href="/GSGA-logo.png" />
		<meta name="generator" content={Astro.generator} />

    <!-- SEO & Social Sharing Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content="anime, vietsub, fansub, phụ đề, phim hoạt hình, xem anime, GSGA Fansub" />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph (Facebook, Discord, Zalo...) -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={image} />
    <meta property="og:image:alt" content={`Ảnh đại diện cho ${title}`} />
    <meta property="og:site_name" content="GSGA Fansub" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
    <meta name="twitter:image:alt" content={`Ảnh đại diện cho ${title}`} />

    <!-- Schema Markup (JSON-LD) for WebSite -->
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    
    <!-- Dynamic Schema Markup for specific pages -->
    {schema && <script type="application/ld+json" set:html={schema} />}
	</head>
	<body class="bg-gray-900 text-white font-sans selection:bg-cyan-500 selection:text-white">
		<header class="bg-gray-800/60 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-700/50">
			<div class="container mx-auto px-6">
        <nav class="flex items-center justify-between py-3">
          <div class="flex items-center">
            <!-- Mobile Menu Button -->
            <div class="md:hidden flex items-center mr-4">
              <button id="mobile-menu-button" class="p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700" aria-label="Open Menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
              </button>
            </div>

            <a href="/" class="group flex items-center gap-4 flex-shrink-0">
              <img src="/GSGA-logo.png" alt="GSGA Fansub Logo" class="h-12 w-auto rounded-md" />
              <div>
                <h1 class="text-xl sm:text-2xl font-bold text-cyan-400 group-hover:text-white transition-colors duration-200 ease-in-out whitespace-nowrap">
                  GSGA Fansub
                </h1>
                <p class="text-sm text-gray-400 group-hover:text-gray-300 transition-colors duration-200 ease-in-out hidden lg:block whitespace-nowrap">Anime hay, Phụ đề cũng phải tốt</p>
              </div>
            </a>
          </div>
          
          <div class="flex items-center gap-2 sm:gap-4">
            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center gap-6 flex-shrink-0">
              <a href="/about" class="text-gray-300 hover:text-white transition-colors font-medium">Giới thiệu</a>
              <a href="/members" class="text-gray-300 hover:text-white transition-colors font-medium">Thành viên</a>
              
              <!-- Guides Dropdown -->
              <div class="relative" id="guides-dropdown-container">
                <button id="guides-dropdown-button" class="flex items-center gap-2 px-3 py-2 bg-cyan-500/20 text-cyan-300 rounded-lg hover:bg-cyan-500/30 hover:text-white transition-colors font-semibold">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 011.085.12L10 11.85l3.66-3.679a.999.999 0 011.085-.12L17.5 6.92a1 1 0 000-1.84l-7-3zM10 13.35l-3.66-3.679a.999.999 0 00-1.085-.12L2.5 11.08a1 1 0 000 1.84l7 3a1 1 0 00.788 0l7-3a1 1 0 000-1.84l-2.75-1.17a.999.999 0 00-1.085.12L10 13.35z" /></svg>
                  <span>Hướng dẫn</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transition-transform duration-200" id="guides-dropdown-arrow" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
                <div id="guides-dropdown-menu" class="hidden absolute top-full right-0 mt-2 w-auto bg-gray-800/90 backdrop-blur-lg border border-gray-700/50 rounded-lg shadow-xl z-50">
                  <div class="p-2 flex flex-col items-end">
                    <a href="/guides" class="whitespace-nowrap px-4 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-cyan-500/20 text-right">Hướng dẫn xem</a>
                    <div class="my-1 border-t border-gray-700/50 w-full"></div>
                    <a href="/guides/mpv-windows" class="whitespace-nowrap px-4 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-cyan-500/20 text-right">Cài đặt mpv (Windows)</a>
                    <a href="/guides/mpv-config" class="whitespace-nowrap px-4 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-cyan-500/20 text-right">Cài đặt config mpv Windows</a>
                    <a href="/guides/mpv-mac" class="whitespace-nowrap px-4 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-cyan-500/20 text-right">Cài đặt mpv (MacOS)</a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Social Icons -->
            <div class="w-px h-6 bg-gray-700 hidden md:block"></div>
            <a href="https://discord.gg/AjcEKFCWNk" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
              <SocialIcon name="discord" className="w-6 h-6" />
              <span class="hidden lg:inline text-sm font-medium">Discord</span>
            </a>
            <a href="https://github.com/Good-Subs-Good-Anime-Vietsub" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
              <SocialIcon name="github" className="w-6 h-6" />
              <span class="hidden lg:inline text-sm font-medium">Github</span>
            </a>
          </div>
        </nav>

        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-gray-800/90 backdrop-blur-lg border-b border-gray-700/50 z-40">
          <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 flex flex-col items-start">
            <a href="/about" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Giới thiệu</a>
            <a href="/members" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700">Thành viên</a>
            <div class="border-t border-gray-700 w-full my-2"></div>
            <div class="w-full">
              <p class="px-3 py-2 text-m font-semibold text-cyan-300 text-left">Hướng dẫn</p>
              <div class="flex flex-col items-start">
                <a href="/guides" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700">Hướng dẫn xem</a>
                <a href="/guides/mpv-windows" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700">Cài đặt mpv (Windows)</a>
                <a href="/guides/mpv-config" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700">Cài đặt config mpv Windows</a>
                <a href="/guides/mpv-mac" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700">Cài đặt mpv (MacOS)</a>
              </div>
            </div>
          </div>
        </div>
      </div>
		</header>
		<main class="container mx-auto p-4 md:p-6 min-h-screen">
			<Breadcrumbs title={title} />
			<slot />
		</main>
		<footer class="text-center py-8 mt-12 border-t border-gray-800">
			<p class="text-gray-500">
				&copy; {new Date().getFullYear()} GSGA. All rights reserved. 
				Powered by <a href="https://astro.build" target="_blank" class="text-cyan-400 hover:underline">Astro</a>
				& <a href="https://anilist.co" target="_blank" class="text-cyan-400 hover:underline">AniList</a>.
			</p>
		</footer>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Mobile menu toggle
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (menuButton && mobileMenu) {
          menuButton.addEventListener('click', (event) => {
            event.stopPropagation();
            mobileMenu.classList.toggle('hidden');
          });

          document.addEventListener('click', (event) => {
            if (!mobileMenu.contains(event.target as Node) && !menuButton.contains(event.target as Node)) {
              mobileMenu.classList.add('hidden');
            }
          });

          // Close mobile menu on scroll
          window.addEventListener('scroll', () => {
            if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
              mobileMenu.classList.add('hidden');
            }
          }, { passive: true });
        }

        // Guides dropdown toggle
        const guidesButton = document.getElementById('guides-dropdown-button');
        const guidesMenu = document.getElementById('guides-dropdown-menu');
        const guidesArrow = document.getElementById('guides-dropdown-arrow');

        if (guidesButton && guidesMenu && guidesArrow) {
          guidesButton.addEventListener('click', (event) => {
            event.stopPropagation();
            const isHidden = guidesMenu.classList.toggle('hidden');
            guidesArrow.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
          });

          document.addEventListener('click', (event) => {
            if (!guidesMenu.contains(event.target as Node) && !guidesButton.contains(event.target as Node)) {
              guidesMenu.classList.add('hidden');
              guidesArrow.style.transform = 'rotate(0deg)';
            }
          });
        }
      });
    </script>
    <Popup />
 </body>
</html>
